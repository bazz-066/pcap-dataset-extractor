/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */
package flowlabeller;

import capstone.Capstone;
import java.io.BufferedReader;
import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.io.IOException;
import java.io.InputStreamReader;
import java.io.UnsupportedEncodingException;
import java.net.URLDecoder;
import java.util.Base64;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.JOptionPane;
import javax.xml.bind.DatatypeConverter;

/**
 *
 * @author baskoro
 */
public class FrameMain extends javax.swing.JFrame {

    private FlowDataset flowDataset;
    
    /**
     * Creates new form FrameMain
     */
    public FrameMain() {
        initComponents();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jScrollPane1 = new javax.swing.JScrollPane();
        txtOriginal = new javax.swing.JTextArea();
        jScrollPane2 = new javax.swing.JScrollPane();
        txtEncoded = new javax.swing.JTextArea();
        btnPrev = new javax.swing.JButton();
        btnNext = new javax.swing.JButton();
        btnBase64Decode = new javax.swing.JButton();
        btnUrlDecode = new javax.swing.JButton();
        lblEncodedText = new javax.swing.JLabel();
        lblOriginalText = new javax.swing.JLabel();
        btnOpen = new javax.swing.JButton();
        btnSave = new javax.swing.JButton();
        jScrollPane4 = new javax.swing.JScrollPane();
        txtSelectionStart = new javax.swing.JTextPane();
        jLabel3 = new javax.swing.JLabel();
        jScrollPane5 = new javax.swing.JScrollPane();
        txtSelectionEnd = new javax.swing.JTextPane();
        lblLength = new javax.swing.JLabel();
        jScrollPane6 = new javax.swing.JScrollPane();
        txtRootDir = new javax.swing.JTextPane();
        lblRootDir = new javax.swing.JLabel();
        btnLoadIndexes = new javax.swing.JButton();
        btnSaveAll = new javax.swing.JButton();
        jLabel1 = new javax.swing.JLabel();
        lblNumOfLabelled = new javax.swing.JLabel();
        jScrollPane7 = new javax.swing.JScrollPane();
        txtIndex = new javax.swing.JTextPane();
        jLabel2 = new javax.swing.JLabel();
        btnOpenIndex = new javax.swing.JButton();
        jScrollPane8 = new javax.swing.JScrollPane();
        txtFilename = new javax.swing.JTextArea();
        btnNoPayload = new javax.swing.JButton();
        cbType = new javax.swing.JComboBox<>();
        jScrollPane3 = new javax.swing.JScrollPane();
        txtPaylEnc = new javax.swing.JTextArea();
        btnHexWithSlashDecode = new javax.swing.JButton();
        btnHexWithoutSlashDecode = new javax.swing.JButton();
        btnDisassemble = new javax.swing.JButton();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);

        txtOriginal.setColumns(20);
        txtOriginal.setFont(new java.awt.Font("Courier 10 Pitch", 0, 18)); // NOI18N
        txtOriginal.setLineWrap(true);
        txtOriginal.setRows(5);
        txtOriginal.addCaretListener(new javax.swing.event.CaretListener() {
            public void caretUpdate(javax.swing.event.CaretEvent evt) {
                txtOriginalCaretUpdate(evt);
            }
        });
        jScrollPane1.setViewportView(txtOriginal);

        txtEncoded.setColumns(20);
        txtEncoded.setFont(new java.awt.Font("Courier 10 Pitch", 1, 14)); // NOI18N
        txtEncoded.setLineWrap(true);
        txtEncoded.setRows(5);
        jScrollPane2.setViewportView(txtEncoded);

        btnPrev.setText("Prev File");
        btnPrev.setEnabled(false);
        btnPrev.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnPrevActionPerformed(evt);
            }
        });

        btnNext.setText("Next File");
        btnNext.setEnabled(false);
        btnNext.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnNextActionPerformed(evt);
            }
        });

        btnBase64Decode.setText("Base64 Decode");
        btnBase64Decode.setEnabled(false);
        btnBase64Decode.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnBase64DecodeActionPerformed(evt);
            }
        });

        btnUrlDecode.setText("URL Decode");
        btnUrlDecode.setEnabled(false);
        btnUrlDecode.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnUrlDecodeActionPerformed(evt);
            }
        });

        lblEncodedText.setText("Encoded Text");

        lblOriginalText.setText("Original Text");

        btnOpen.setText("Open");
        btnOpen.setEnabled(false);
        btnOpen.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnOpenActionPerformed(evt);
            }
        });

        btnSave.setText("Save Location");
        btnSave.setEnabled(false);
        btnSave.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnSaveActionPerformed(evt);
            }
        });

        jScrollPane4.setViewportView(txtSelectionStart);

        jLabel3.setText("Selected Bytes");

        jScrollPane5.setViewportView(txtSelectionEnd);

        lblLength.setText("Length: -");

        txtRootDir.setText("/home/baskoro/exwindows/Datasets/Metasploit/");
        jScrollPane6.setViewportView(txtRootDir);

        lblRootDir.setText("RootDir:");

        btnLoadIndexes.setText("Load Indexes");
        btnLoadIndexes.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnLoadIndexesActionPerformed(evt);
            }
        });

        btnSaveAll.setText("Save All");
        btnSaveAll.setEnabled(false);
        btnSaveAll.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnSaveAllActionPerformed(evt);
            }
        });

        jLabel1.setText("Num of Labelled data (this session/total) :");

        jScrollPane7.setViewportView(txtIndex);

        jLabel2.setText("Go to index:");

        btnOpenIndex.setText("Go");
        btnOpenIndex.setEnabled(false);
        btnOpenIndex.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnOpenIndexActionPerformed(evt);
            }
        });

        txtFilename.setColumns(20);
        txtFilename.setLineWrap(true);
        txtFilename.setRows(5);
        jScrollPane8.setViewportView(txtFilename);

        btnNoPayload.setText("No Payload");
        btnNoPayload.setEnabled(false);
        btnNoPayload.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnNoPayloadActionPerformed(evt);
            }
        });

        cbType.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "shellcode", "cmd", "perl", "javascript", "ruby", "php", "python", "sql" }));

        txtPaylEnc.setColumns(20);
        txtPaylEnc.setRows(5);
        jScrollPane3.setViewportView(txtPaylEnc);

        btnHexWithSlashDecode.setText("Hex with \\ Decode");
        btnHexWithSlashDecode.setEnabled(false);
        btnHexWithSlashDecode.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnHexWithSlashDecodeActionPerformed(evt);
            }
        });

        btnHexWithoutSlashDecode.setText("Hex Decode");
        btnHexWithoutSlashDecode.setEnabled(false);
        btnHexWithoutSlashDecode.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnHexWithoutSlashDecodeActionPerformed(evt);
            }
        });

        btnDisassemble.setText("Disassemble");
        btnDisassemble.setEnabled(false);
        btnDisassemble.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnDisassembleActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jScrollPane1, javax.swing.GroupLayout.DEFAULT_SIZE, 748, Short.MAX_VALUE)
                    .addComponent(jScrollPane2, javax.swing.GroupLayout.Alignment.TRAILING)
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(lblRootDir)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(jScrollPane6))
                    .addGroup(layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(lblEncodedText)
                            .addComponent(lblOriginalText))
                        .addGap(0, 0, Short.MAX_VALUE))
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(jScrollPane8, javax.swing.GroupLayout.PREFERRED_SIZE, 636, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jScrollPane7)
                            .addGroup(layout.createSequentialGroup()
                                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                    .addComponent(jLabel2)
                                    .addComponent(btnOpenIndex))
                                .addGap(0, 0, Short.MAX_VALUE)))))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                        .addGroup(layout.createSequentialGroup()
                            .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                .addComponent(btnLoadIndexes, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                                    .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING, false)
                                        .addComponent(btnSaveAll, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                        .addComponent(btnPrev, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                                    .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                    .addComponent(btnOpen)
                                    .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                    .addComponent(btnNext))
                                .addComponent(jLabel1))
                            .addContainerGap())
                        .addGroup(layout.createSequentialGroup()
                            .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                .addComponent(btnBase64Decode)
                                .addComponent(btnUrlDecode)
                                .addComponent(jLabel3)
                                .addGroup(layout.createSequentialGroup()
                                    .addComponent(jScrollPane4, javax.swing.GroupLayout.PREFERRED_SIZE, 87, javax.swing.GroupLayout.PREFERRED_SIZE)
                                    .addGap(46, 46, 46)
                                    .addComponent(jScrollPane5, javax.swing.GroupLayout.PREFERRED_SIZE, 87, javax.swing.GroupLayout.PREFERRED_SIZE))
                                .addComponent(lblLength))
                            .addGap(110, 110, 110)))
                    .addGroup(layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(lblNumOfLabelled)
                            .addGroup(layout.createSequentialGroup()
                                .addComponent(btnNoPayload)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(btnSave))
                            .addComponent(cbType, javax.swing.GroupLayout.PREFERRED_SIZE, 220, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(jScrollPane3, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addComponent(btnHexWithSlashDecode)
                            .addComponent(btnHexWithoutSlashDecode)
                            .addComponent(btnDisassemble))
                        .addGap(77, 77, 77))))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                    .addGroup(layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(layout.createSequentialGroup()
                                .addGap(9, 9, 9)
                                .addComponent(lblRootDir))
                            .addComponent(btnLoadIndexes)
                            .addComponent(jScrollPane6, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(layout.createSequentialGroup()
                                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                                    .addComponent(btnPrev)
                                    .addComponent(btnNext)
                                    .addComponent(btnOpen))
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(btnSaveAll)
                                .addGap(12, 12, 12)
                                .addComponent(jLabel1))
                            .addComponent(jScrollPane8, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)))
                    .addGroup(javax.swing.GroupLayout.Alignment.LEADING, layout.createSequentialGroup()
                        .addGap(30, 30, 30)
                        .addComponent(jLabel2)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(jScrollPane7, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(btnOpenIndex)))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(lblOriginalText)
                        .addGap(13, 13, 13))
                    .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, layout.createSequentialGroup()
                        .addComponent(lblNumOfLabelled)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)))
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jScrollPane1)
                    .addGroup(layout.createSequentialGroup()
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                            .addComponent(btnNoPayload)
                            .addComponent(btnSave))
                        .addGap(12, 12, 12)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.TRAILING)
                            .addComponent(jScrollPane5, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addGroup(layout.createSequentialGroup()
                                .addComponent(jLabel3)
                                .addGap(17, 17, 17)
                                .addComponent(jScrollPane4, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)))
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(lblLength)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(cbType, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(jScrollPane3, javax.swing.GroupLayout.DEFAULT_SIZE, 86, Short.MAX_VALUE)))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(lblEncodedText)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(jScrollPane2, javax.swing.GroupLayout.PREFERRED_SIZE, 230, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(btnBase64Decode)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(btnUrlDecode)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(btnHexWithSlashDecode)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(btnHexWithoutSlashDecode)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(btnDisassemble)))
                .addContainerGap())
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void btnOpenActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnOpenActionPerformed
        //this.openFile();
    }//GEN-LAST:event_btnOpenActionPerformed

    private void txtOriginalCaretUpdate(javax.swing.event.CaretEvent evt) {//GEN-FIRST:event_txtOriginalCaretUpdate
        int start, end;
        start = this.txtOriginal.getSelectionStart();
        end = this.txtOriginal.getSelectionEnd();
        
        if(start >= 0 && start != end) {
            this.txtSelectionStart.setText(start + "");
            this.txtSelectionEnd.setText((end-1) + "");
            this.lblLength.setText("Length: " + (end-start) + " bytes.");
        }    
    }//GEN-LAST:event_txtOriginalCaretUpdate

    private void btnUrlDecodeActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnUrlDecodeActionPerformed
        String selectedText = this.txtOriginal.getSelectedText();
        if(selectedText.length() > 0) {
            try {
                this.txtEncoded.setText(URLDecoder.decode(selectedText, "UTF-8"));
                this.txtEncoded.setCaretPosition(0);
            } catch (UnsupportedEncodingException ex) {
                JOptionPane.showMessageDialog(this, "Decoding failed." + ex.getMessage());
            }
        }
    }//GEN-LAST:event_btnUrlDecodeActionPerformed

    private void btnBase64DecodeActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnBase64DecodeActionPerformed
        String selectedText = this.txtOriginal.getSelectedText();
        if(selectedText.length() > 0) {
            try {
                byte[] decodedBytes = Base64.getDecoder().decode(selectedText);
                this.txtEncoded.setText(new String(decodedBytes));
            } catch (IllegalArgumentException ex) {
                JOptionPane.showMessageDialog(this, "Not a valid Base64 string." + ex.getMessage());
            }
        }
    }//GEN-LAST:event_btnBase64DecodeActionPerformed

    private void btnLoadIndexesActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnLoadIndexesActionPerformed
        try {
            this.flowDataset = new FlowDataset(this.txtRootDir.getText());
            this.btnBase64Decode.setEnabled(true);
            this.btnNext.setEnabled(true);
            this.btnOpen.setEnabled(true);
            this.btnPrev.setEnabled(true);
            this.btnSave.setEnabled(true);
            this.btnUrlDecode.setEnabled(true);
            this.btnHexWithSlashDecode.setEnabled(true);
            this.btnHexWithoutSlashDecode.setEnabled(true);
            this.btnSaveAll.setEnabled(true);
            this.btnOpenIndex.setEnabled(true);
            this.btnNoPayload.setEnabled(true);
            this.btnLoadIndexes.setEnabled(false);
            this.btnDisassemble.setEnabled(true);
            
            Flow flow = this.flowDataset.nextFlowFile();
            this.txtFilename.setText(flow.getFlowAbsoluteFilename());
            this.openFile(flow);
            this.lblNumOfLabelled.setText(this.flowDataset.getNumOfLabelledThisSession() + "/" + this.flowDataset.getNumOfLabelledTotal());
        } catch (IOException ex) {
            Logger.getLogger(FrameMain.class.getName()).log(Level.SEVERE, null, ex);
        }
    }//GEN-LAST:event_btnLoadIndexesActionPerformed

    private void btnNextActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnNextActionPerformed
        Flow flow = this.flowDataset.nextFlowFile();
        this.txtFilename.setText(flow.getFlowAbsoluteFilename());
        
        this.openFile(flow);
    }//GEN-LAST:event_btnNextActionPerformed

    private void btnPrevActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnPrevActionPerformed
        Flow flow = this.flowDataset.prevFlowFile();
        this.txtFilename.setText(flow.getFlowAbsoluteFilename());
        
        this.openFile(flow);
    }//GEN-LAST:event_btnPrevActionPerformed

    private void btnSaveActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnSaveActionPerformed
        this.flowDataset.updateCurrent(Integer.parseInt(this.txtSelectionStart.getText()), Integer.parseInt(this.txtSelectionEnd.getText()), this.cbType.getSelectedItem().toString());
        //JOptionPane.showMessageDialog(this, "It's bloody saved");
        this.lblNumOfLabelled.setText(this.flowDataset.getNumOfLabelledThisSession() + "/" + this.flowDataset.getNumOfLabelledTotal());
    }//GEN-LAST:event_btnSaveActionPerformed

    private void btnSaveAllActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnSaveAllActionPerformed
        try {
            this.flowDataset.saveDataset();
            this.lblNumOfLabelled.setText(this.flowDataset.getNumOfLabelledThisSession() + "/" + this.flowDataset.getNumOfLabelledTotal());
        } catch (IOException ex) {
            Logger.getLogger(FrameMain.class.getName()).log(Level.SEVERE, null, ex);
        }
    }//GEN-LAST:event_btnSaveAllActionPerformed

    private void btnOpenIndexActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnOpenIndexActionPerformed
        Flow flow = this.flowDataset.get(Integer.parseInt(this.txtIndex.getText()));
        this.flowDataset.setCurrentIndex(Integer.parseInt(this.txtIndex.getText()));
        this.txtFilename.setText(flow.getFlowAbsoluteFilename());
        this.openFile(flow);
        
    }//GEN-LAST:event_btnOpenIndexActionPerformed

    private void btnNoPayloadActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnNoPayloadActionPerformed
        this.txtSelectionStart.setText("-2");
        this.txtSelectionEnd.setText("-1");
    }//GEN-LAST:event_btnNoPayloadActionPerformed

    private void btnHexWithSlashDecodeActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnHexWithSlashDecodeActionPerformed
        String selectedText = this.txtOriginal.getSelectedText();
        if(selectedText.length() > 0) {
            try {
                String hexData = new String(DatatypeConverter.parseHexBinary(selectedText.replace("\\x", "")));
                this.txtEncoded.setText(new String(hexData));
                //this.txtEncoded.setText(selectedText.replace("\\x", ""));
            } catch (IllegalArgumentException ex) {
                JOptionPane.showMessageDialog(this, "Not a valid Hex string." + ex.getMessage());
            }
        }
    }//GEN-LAST:event_btnHexWithSlashDecodeActionPerformed

    private void btnHexWithoutSlashDecodeActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnHexWithoutSlashDecodeActionPerformed
        String selectedText = this.txtOriginal.getSelectedText();
        if(selectedText.length() > 0) {
            try {
                String hexData = new String(DatatypeConverter.parseHexBinary(selectedText));
                this.txtEncoded.setText(new String(hexData));
                //this.txtEncoded.setText(selectedText.replace("\\x", ""));
            } catch (IllegalArgumentException ex) {
                JOptionPane.showMessageDialog(this, "Not a valid Hex string." + ex.getMessage());
            }
        }
    }//GEN-LAST:event_btnHexWithoutSlashDecodeActionPerformed

    private void btnDisassembleActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnDisassembleActionPerformed
        Capstone cs = new Capstone(Capstone.CS_ARCH_X86, Capstone.CS_MODE_32);
        Capstone.CsInsn[] allInsns;
        
        byte[] selectedText = this.txtOriginal.getSelectedText().getBytes();
        if(selectedText.length > 0) {
            allInsns = cs.disasm(selectedText, 0x1000);
            this.txtEncoded.setText("");
            for(int i=0; i<allInsns.length; i++) {
                this.txtEncoded.append(allInsns[i].address + ":" + allInsns[i].mnemonic + " " + allInsns[i].opStr + "\n");
            }
            
            this.txtEncoded.setCaretPosition(0);
        }
    }//GEN-LAST:event_btnDisassembleActionPerformed

    
    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException ex) {
            java.util.logging.Logger.getLogger(FrameMain.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (InstantiationException ex) {
            java.util.logging.Logger.getLogger(FrameMain.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (IllegalAccessException ex) {
            java.util.logging.Logger.getLogger(FrameMain.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(FrameMain.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>

        /* Create and display the form */
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                new FrameMain().setVisible(true);
            }
        });
    }

    public void openFile(Flow flow) {
        String filename = this.txtFilename.getText();
        if(filename.length() <= 0) {
            JOptionPane.showMessageDialog(this, "Enter the bloody filename");
        }
        else {
            try {
                FileInputStream fis = new FileInputStream(filename);
                BufferedReader br = new BufferedReader(new InputStreamReader(fis));
                
                char[] buffer = new char[1024];
                this.txtOriginal.setText("");
                int numChars = 0;
                        
                while((numChars = br.read(buffer)) > 0) {
                    this.txtOriginal.append(new String(buffer, 0, numChars));
                }
                
                this.txtOriginal.setCaretPosition(0);
                br.close();
                fis.close();
                
                this.txtSelectionStart.setText(flow.getStart() + "");
                this.txtSelectionEnd.setText(flow.getEnd() + "");
                this.txtIndex.setText((this.flowDataset.getCurrentIndex() - 1) + "");
                if(flow.getStart() >= 0) {
                    this.lblLength.setText("Length: " + (flow.getEnd()-flow.getStart()) + " bytes.");
                }
                
                this.cbType.setSelectedItem(flow.getPayloadType());
                this.txtPaylEnc.setText(flow.getPayloadName() + "\n" + flow.getEncoderName());
                
                if(flow.getStart() != flow.getEnd()) {
                    this.txtOriginal.setSelectionStart(flow.getStart());
                    this.txtOriginal.setSelectionEnd(flow.getEnd() + 1);
                    this.txtOriginal.getCaret().setSelectionVisible(true);
                }
            } catch (FileNotFoundException ex) {
                JOptionPane.showMessageDialog(this, "File " + filename + " does not exist");
            } catch (IOException ex) {
                Logger.getLogger(FrameMain.class.getName()).log(Level.SEVERE, null, ex);
            }
        }
    }
    
    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btnBase64Decode;
    private javax.swing.JButton btnDisassemble;
    private javax.swing.JButton btnHexWithSlashDecode;
    private javax.swing.JButton btnHexWithoutSlashDecode;
    private javax.swing.JButton btnLoadIndexes;
    private javax.swing.JButton btnNext;
    private javax.swing.JButton btnNoPayload;
    private javax.swing.JButton btnOpen;
    private javax.swing.JButton btnOpenIndex;
    private javax.swing.JButton btnPrev;
    private javax.swing.JButton btnSave;
    private javax.swing.JButton btnSaveAll;
    private javax.swing.JButton btnUrlDecode;
    private javax.swing.JComboBox<String> cbType;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JScrollPane jScrollPane2;
    private javax.swing.JScrollPane jScrollPane3;
    private javax.swing.JScrollPane jScrollPane4;
    private javax.swing.JScrollPane jScrollPane5;
    private javax.swing.JScrollPane jScrollPane6;
    private javax.swing.JScrollPane jScrollPane7;
    private javax.swing.JScrollPane jScrollPane8;
    private javax.swing.JLabel lblEncodedText;
    private javax.swing.JLabel lblLength;
    private javax.swing.JLabel lblNumOfLabelled;
    private javax.swing.JLabel lblOriginalText;
    private javax.swing.JLabel lblRootDir;
    private javax.swing.JTextArea txtEncoded;
    private javax.swing.JTextArea txtFilename;
    private javax.swing.JTextPane txtIndex;
    private javax.swing.JTextArea txtOriginal;
    private javax.swing.JTextArea txtPaylEnc;
    private javax.swing.JTextPane txtRootDir;
    private javax.swing.JTextPane txtSelectionEnd;
    private javax.swing.JTextPane txtSelectionStart;
    // End of variables declaration//GEN-END:variables
}
